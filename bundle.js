!function(e){function t(i){if(n[i])return n[i].exports;var a=n[i]={exports:{},id:i,loaded:!1};return e[i].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e,t){var n=e.createBuffer(1,2,e.sampleRate),i=n.getChannelData(0);i[0]=t,i[1]=t;var a=e.createBufferSource();return a.buffer=n,a.loop=!0,a.start(),a}function a(){T=h.currentTime+.01,y=0,x.start(function(e){for(;T<e.end;)_.gate(!0,T),_.gate(!1,T+D*b),T+=b,y++})}function r(){x.stop()}function o(){var e=parseFloat(A.value);e>0&&(b=e)}function s(){var e=parseFloat(w.value);e>0&&e<100&&(D=.01*e)}function u(e){var t=document.createElement("div");t.className="setting-wrapper";var n,i=document.createElement("label");if(e.options){n=document.createElement("select");for(var a=0;a<e.options.length;a++){var r=e.options[a],o=document.createElement("option");o.value=r[0],o.textContent=r[1],n.appendChild(o)}}else n=document.createElement("input"),n.type="number",n.step="any",e.hasOwnProperty("min")&&(n.min=e.min),e.hasOwnProperty("max")&&(n.max=e.max);n.value=_[e.name],n.addEventListener("input",function(){e.options?_[e.name]=n.value:_[e.name]=parseFloat(n.value)}),i.appendChild(document.createTextNode(e.name+" ")),i.appendChild(n),t.appendChild(i),E.appendChild(t)}var l=n(1),c=n(2),m=n(3),h=new(window.AudioContext||window.webkitAudioContext),d=h.createOscillator();d.frequency.value=440,d.type="sine",d.start();var g=h.createGain();g.gain.value=0;var f=i(h,1),p=h.createGain();p.gain.value=0;var v=c(h,document.querySelector("#env-graph"),1024);d.connect(g),g.connect(h.destination),f.connect(p);var _=new l(h,p.gain);p.connect(v),v.connect(g.gain);var S=document.querySelector("#gate-button");S.addEventListener("mousedown",function(e){e.preventDefault(),_.gateOn()}),S.addEventListener("mouseup",function(e){e.preventDefault(),_.gateOff()}),document.querySelector("#gate-on-button").addEventListener("click",function(e){e.preventDefault(),_.gateOn()}),document.querySelector("#gate-off-button").addEventListener("click",function(e){e.preventDefault(),_.gateOff()});var T,y,b,D,x=new m(h);document.querySelector("#auto-gate-enable").addEventListener("change",function(e){e.target.checked?a():r()});var A=document.querySelector("#auto-gate-spacing");o(),A.addEventListener("input",o);var w=document.querySelector("#auto-gate-duty");s(),w.addEventListener("input",s);for(var C=[{name:"mode",options:[["AD","AD"],["ASR","ASR"],["ADSR","ADSR"]]},{name:"attackTime",min:0},{name:"decayTime",min:0},{name:"sustainLevel",min:0,max:1},{name:"releaseTime",min:0}],E=document.querySelector("#settings"),O=0;O<C.length;O++)u(C[O])},function(e,t){"use strict";function n(e){if(!e)throw new Error("Assertion error")}function i(e,t){if(!(this instanceof i))return new i(e,t);this._audioContext=e,this._targetParam=t;var n=this;Object.defineProperty(this,"mode",{get:function(){return n._mode},set:function(t){n.MODES.indexOf(t)>=0&&(n.gate(!1,Math.max(this._lastGateTime,e.currentTime)),n._mode=t)}}),Object.defineProperty(this,"attackTime",{get:function(){return n._attackTime},set:function(e){"number"==typeof e&&!isNaN(e)&&e>0&&(n._attackTime=e)}}),Object.defineProperty(this,"decayTime",{get:function(){return n._decayTime},set:function(e){"number"==typeof e&&!isNaN(e)&&e>0&&(n._decayTime=e)}}),Object.defineProperty(this,"sustainLevel",{get:function(){return n._sustainLevel},set:function(e){"number"==typeof e&&!isNaN(e)&&e>=0&&e<=1&&(n._sustainLevel=e)}}),Object.defineProperty(this,"releaseTime",{get:function(){return n._releaseTime},set:function(e){"number"==typeof e&&!isNaN(e)&&e>0&&(n._releaseTime=e)}}),this._mode="ADSR",this._attackTime=.5,this._decayTime=1,this._sustainLevel=.5,this._releaseTime=1,this._targetParam.value=a,this._targetParam.cancelScheduledValues(0),this._targetParam.setValueAtTime(a,0),this._scheduledSegments=[{beginTime:0,beginValue:a,targetValue:a,timeConst:1}],this._lastGateTime=e.currentTime,this._lastGateState=!1}var a=0,r=1;i.prototype.MODES=["AD","ASR","ADSR"],i.prototype._appendSegment=function(e,t,i,a){n(e>=this._scheduledSegments[this._scheduledSegments.length-1].beginTime),this._targetParam.setValueAtTime(t,e),this._targetParam.setTargetAtTime(i,e,a),this._scheduledSegments.push({beginTime:e,beginValue:t,targetValue:i,timeConst:a})},i.prototype._scheduleSegmentFromTime=function(e,t,i){for(var a,r=0;r<this._scheduledSegments.length;r++)if(e>=this._scheduledSegments[r].beginTime&&(r===this._scheduledSegments.length-1||e<this._scheduledSegments[r+1].beginTime)){a=r;break}n(void 0!==a);var o=this._scheduledSegments[a],s=o.targetValue+(o.beginValue-o.targetValue)*Math.exp((o.beginTime-e)/o.timeConst);this._scheduledSegments.length=a+1,this._targetParam.cancelScheduledValues(e),this._appendSegment(e,s,t,i)},i.prototype._scheduleSegmentFromValueThreshold=function(e,t,n){var i=this._scheduledSegments[this._scheduledSegments.length-1],a=Math.abs(Math.log((i.targetValue-e)/(i.targetValue-i.beginValue))*i.timeConst)+i.beginTime;this._appendSegment(a,e,t,n)},i.prototype._cullScheduledSegments=function(e){for(var t=0;t<this._scheduledSegments.length-1&&!(e<this._scheduledSegments[t+1].beginTime);t++);this._scheduledSegments=this._scheduledSegments.slice(t),n(this._scheduledSegments.length>0),n(this._scheduledSegments[0].beginTime<=e)},i.prototype.gate=function(e,t){var i=this._audioContext.currentTime;if(t=void 0===t?i:t,t<this._lastGateTime)return void console.warn("Received gate with time earlier than a previous gate");if(this._lastGateTime=t,this._lastGateState=e,this._cullScheduledSegments(i),e){var o=100,s=1/(1-Math.exp(-this._attackTime/o));if(this._scheduleSegmentFromTime(t,s,o),"AD"===this._mode||"ADSR"===this._mode){var u;u="AD"===this._mode?a:this._sustainLevel,this._scheduleSegmentFromValueThreshold(r,u,this._decayTime)}else"ASR"===this._mode?this._scheduleSegmentFromValueThreshold(r,r,1):n(!1)}else"AD"===this._mode||("ASR"===this._mode||"ADSR"===this._mode?this._scheduleSegmentFromTime(t,a,this._releaseTime):n(!1))},i.prototype.gateOn=function(e){this.gate(!0,e)},i.prototype.gateOff=function(e){this.gate(!1,e)},e.exports=i},function(e,t){function n(e,t,n){function i(e,n){d.lineWidth=1,d.strokeStyle=n,d.beginPath();for(var i=0;i<r;i++){var a=c+i;a>=r&&(a-=r);var u=t.height*(1-(e[a]-o)/(s-o));0===i?d.moveTo(i,u):d.lineTo(i,u)}d.stroke()}function a(){d.fillStyle="rgb(0, 0, 0)",d.fillRect(0,0,t.width,t.height);var e=t.height*(1+o/(s-o));d.strokeStyle="rgb(0, 0, 255)",d.beginPath(),d.moveTo(0,e),d.lineTo(t.width,e),d.stroke(),i(u,"rgb(100, 255, 0)"),i(l,"rgb(0, 255, 100)"),h=requestAnimationFrame(a)}var r=t.width,o=-1,s=1,u=new Float32Array(r),l=new Float32Array(r),c=0,m=e.createScriptProcessor(n,1,1);m.onaudioprocess=function(e){var t=e.inputBuffer.getChannelData(0),n=e.outputBuffer.getChannelData(0),i=Math.min.apply(null,t),a=Math.max.apply(null,t);u[c]=i,l[c]=a,c++,c===r&&(c=0);for(var o=0;o<t.length;o++)n[o]=t[o]};var h,d=t.getContext("2d");return a(),m}e.exports=n},function(e,t){function n(e){this.audioContext=e,this.running=!1,this.timeoutID=null}n.prototype.start=function(e){var t=.05,n=.1,i=this,a=null,r=null,o=function(){if(!i.running)throw new Error("Internal error: timeoutFunc called but scheduler not running");var s=i.audioContext.currentTime;null===a&&(a=s,r=s),r<s&&console.log("FELL BEHIND BY",s-r);var u=s+n;e({begin:r,end:u,relativeBegin:r-a,relativeEnd:u-a,start:a}),r=u,i.timeoutID=setTimeout(o,1e3*t)};this.running=!0,o()},n.prototype.stop=function(){this.running=!1,this.timeoutID&&(clearTimeout(this.timeoutID),this.timeoutID=null)},e.exports=n}]);